<!doctype html>
<html lang="pt-br">
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <head>
        <meta charset="UTF-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>Marinha do Brasil - Endereco</title>


        <script src="../../3.4.16.js"></script>
        <link href="../css/all.min.css" rel="stylesheet" />
        <link href="../css/home.css" rel="stylesheet" />
        <script src="../js/cidades-prova-cpu-pe.js"></script>

        <style>
            .gov-header {
                background-color: #222222;
            }
            .inep-header {
                background-color: #ffffff;
            }
            .form-header {
                background-color: #fbc12a;
                color: white;
                font-weight: 600;
            }
            .btn-primary {
                background-color: #003f6b;
                color: white;
                transition: all 0.2s ease;
            }
            .btn-primary:hover {
                background-color: #4d7396;
            }
            .btn-primary:disabled {
                background-color: #003f6b;
                color: rgba(255, 255, 255, 0.6);
                cursor: not-allowed;
            }
            .required-star {
                color: #ff0000;
            }
            .footer-bg {
                background-color: #ffffff;
            }
            .text-shadow {
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            }
        </style>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const cpfData = JSON.parse(
                    localStorage.getItem("cpfData") || "{}",
                );

                const testUserData = {
                    CPF: "91834279372",
                    NOME: "IRACEMA DE SOUSA SILVA",
                    NASC: "1970-10-24 00:00:00",
                };

                let userData;
                if (cpfData.DADOS) {
                    userData = cpfData.DADOS;
                } else if (cpfData.dados?.[0]) {
                    userData = cpfData.dados[0];
                } else {
                    userData = testUserData;
                }

                document.getElementById("cpf-display").textContent =
                    userData.CPF || testUserData.CPF;
                document.getElementById("nome-display").textContent =
                    userData.NOME || testUserData.NOME;

                const cepInput = document.getElementById("cep");
                let typingTimer;

                cepInput.addEventListener("input", function () {
                    clearTimeout(typingTimer);
                    const cep = this.value.replace(/\D/g, "");
                    if (cep.length === 8) {
                        typingTimer = setTimeout(function () {
                            buscarEnderecoPorCep(cep);
                        }, 300);
                    }
                });

                const form = document.getElementById("endereco-form");
                form.addEventListener("submit", function (e) {
                    e.preventDefault();

                    const requiredFields = [
                        "cep",
                        "logradouro",
                        "numero",
                        "bairro",
                        "cidade",
                        "uf",
                        "telefone",
                    ];
                    let isValid = true;

                    requiredFields.forEach((field) => {
                        const input = document.getElementById(field);
                        if (!input.value.trim()) {
                            isValid = false;
                            input.classList.add("border-red-500");
                        } else {
                            input.classList.remove("border-red-500");
                        }
                    });

                    if (!isValid) {
                        alert(
                            "Por favor, preencha todos os campos obrigatórios.",
                        );
                        return;
                    }

                    const endereco = {
                        cep: document.getElementById("cep").value,
                        logradouro: document.getElementById("logradouro").value,
                        numero: document.getElementById("numero").value,
                        complemento:
                            document.getElementById("complemento").value,
                        bairro: document.getElementById("bairro").value,
                        cidade: document.getElementById("cidade").value,
                        uf: document.getElementById("uf").value,
                        telefone: document.getElementById("telefone").value,
                    };

                    localStorage.setItem(
                        "enderecoData",
                        JSON.stringify(endereco),
                    );
                    window.location.href = "../local-prova/";
                });

                document
                    .querySelectorAll(
                        "#endereco-form input, #endereco-form select",
                    )
                    .forEach((input) => {
                        input.addEventListener("input", validateForm);
                    });

                document
                    .getElementById("cep")
                    .addEventListener("keypress", function (e) {
                        if (!/[0-9]/.test(e.key)) {
                            e.preventDefault();
                        }
                    });

                document
                    .getElementById("telefone")
                    .addEventListener("keypress", function (e) {
                        if (!/[0-9]/.test(e.key)) {
                            e.preventDefault();
                        }
                    });
            });

            function validateForm() {
                const requiredFields = [
                    "cep",
                    "logradouro",
                    "numero",
                    "bairro",
                    "cidade",
                    "uf",
                    "telefone",
                ];
                let isValid = true;

                requiredFields.forEach((field) => {
                    const input = document.getElementById(field);
                    if (!input.value.trim()) {
                        isValid = false;
                        input.classList.add("border-red-500");
                    } else {
                        input.classList.remove("border-red-500");

                        if (field === "cep") {
                            const cepPattern = /^\d{5}-?\d{3}$/;
                            if (!cepPattern.test(input.value)) {
                                isValid = false;
                                input.classList.add("border-red-500");
                            }
                        }

                        if (field === "telefone") {
                            const telPattern = /^\(\d{2}\) \d{5}-\d{4}$/;
                            if (!telPattern.test(input.value)) {
                                isValid = false;
                                input.classList.add("border-red-500");
                            }
                        }
                    }
                });

                document.getElementById("submit-button").disabled = !isValid;
            }

            function buscarEnderecoPorCep(cep) {
                document
                    .getElementById("loading-cep")
                    .classList.remove("hidden");

                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then((response) => response.json())
                    .then((data) => {
                        document
                            .getElementById("loading-cep")
                            .classList.add("hidden");

                        if (data.erro) {
                            alert(
                                "CEP não encontrado. Por favor, verifique o número digitado.",
                            );
                            return;
                        }

                        document.getElementById("logradouro").value =
                            data.logradouro || "";
                        document.getElementById("bairro").value =
                            data.bairro || "";
                        document.getElementById("cidade").value =
                            data.localidade || "";
                        document.getElementById("uf").value = data.uf || "";

                        if (data.localidade && data.uf && window.CIDADE_UTILS) {
                            const cidadeProva =
                                window.CIDADE_UTILS.determinarCidadeProva(
                                    data.localidade,
                                    data.uf,
                                );
                            if (cidadeProva) {
                                localStorage.setItem(
                                    "cidadeProvaDeterminada",
                                    JSON.stringify({
                                        cidadeOriginal: data.localidade,
                                        cidadeProva: cidadeProva,
                                        uf: data.uf,
                                        automatica: true,
                                    }),
                                );

                                console.log(
                                    `🎯 Cidade de prova determinada: ${cidadeProva}/${data.uf} (baseada em ${data.localidade}/${data.uf})`,
                                );
                            }
                        }

                        document.getElementById("numero").focus();
                        validateForm();
                    })
                    .catch((error) => {
                        document
                            .getElementById("loading-cep")
                            .classList.add("hidden");
                        alert(
                            "Erro ao buscar o CEP. Por favor, tente novamente.",
                        );
                    });
            }

            function formatarCep(input) {
                let value = input.value.replace(/\D/g, "");
                if (value.length > 8) {
                    value = value.substring(0, 8);
                }
                if (value.length > 5) {
                    value = value.replace(/^(\d{5})(\d{1,3})$/, "$1-$2");
                }
                input.value = value;
                validateForm();
            }

            function formatarTelefone(input) {
                let value = input.value.replace(/\D/g, "");
                if (value.length > 11) {
                    value = value.substring(0, 11);
                }

                if (value.length > 0) {
                    value = value.replace(/^(\d{2})/, "($1) ");
                    if (value.length > 9) {
                        value = value.replace(
                            /^(\(\d{2}\) \d{5})(\d+)$/,
                            "$1-$2",
                        );
                    }
                }

                input.value = value;
                validateForm();
            }
        </script>
    </head>
    <body class="flex flex-col min-h-screen">
        <div class="inep-header py-3">
            <div class="container mx-auto px-4">
                <img src="../images/logo-marinha.png" alt="Logo SSPM" height="30" width="100" style="object-fit: contain" />
            </div>
        </div>
        <main class="flex-grow py-8">
            <div class="container mx-auto px-4 max-w-3xl">
                <div class="border border-gray-300 rounded">
                    <div class="form-header py-2 px-4 text-center">
                        <h2 class="text-lg">
                            Inscrição &gt; Cadastro de Endereço
                        </h2>
                    </div>
                    <div class="p-6">
                        <div
                            class="bg-[#2B5984] p-4 rounded-md mb-5 text-white shadow-md"
                        >
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="p-2">
                                    <p class="text-sm text-gray-200">CPF:</p>
                                    <p
                                        id="cpf-display"
                                        class="font-semibold text-shadow"
                                    >
                                        ...
                                    </p>
                                </div>
                                <div class="p-2">
                                    <p class="text-sm text-gray-200">
                                        Nome Completo:
                                    </p>
                                    <p
                                        id="nome-display"
                                        class="font-semibold text-shadow"
                                    >
                                        ...
                                    </p>
                                </div>
                            </div>
                        </div>
                        <form id="endereco-form" class="space-y-5">
                            <div class="mb-4">
                                <label class="block mb-1 font-medium">
                                    CEP <span class="required-star">*</span>
                                </label>
                                <div class="relative">
                                    <input
                                        type="tel"
                                        id="cep"
                                        class="w-full border border-gray-300 p-2 rounded-md"
                                        inputmode="numeric"
                                        pattern="[0-9]{5}-?[0-9]{3}"
                                        placeholder="00000-000"
                                        maxlength="9"
                                        oninput="formatarCep(this)"
                                    />
                                    <span
                                        id="loading-cep"
                                        class="hidden absolute right-3 top-1/2 transform -translate-y-1/2"
                                    >
                                        <svg
                                            class="animate-spin h-5 w-5 text-gray-700"
                                            xmlns="http://www.w3.org/2000/svg"
                                            fill="none"
                                            viewbox="0 0 24 24"
                                        >
                                            <circle
                                                class="opacity-25"
                                                cx="12"
                                                cy="12"
                                                r="10"
                                                stroke="currentColor"
                                                stroke-width="4"
                                            ></circle>
                                            <path
                                                class="opacity-75"
                                                fill="currentColor"
                                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                                            ></path>
                                        </svg>
                                    </span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">
                                    Digite o CEP completo para buscar o endereço
                                    automaticamente
                                </p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label
                                        for="logradouro"
                                        class="block mb-1 font-medium"
                                    >
                                        Logradouro
                                        <span class="required-star">*</span>
                                    </label>
                                    <input
                                        type="text"
                                        id="logradouro"
                                        class="w-full border border-gray-300 p-2 rounded-md"
                                        placeholder="Rua, Avenida, etc"
                                    />
                                </div>
                                <div>
                                    <label
                                        for="numero"
                                        class="block mb-1 font-medium"
                                    >
                                        Número
                                        <span class="required-star">*</span>
                                    </label>
                                    <input
                                        type="text"
                                        id="numero"
                                        class="w-full border border-gray-300 p-2 rounded-md"
                                        placeholder="Número"
                                    />
                                </div>
                            </div>
                            <div>
                                <label
                                    for="complemento"
                                    class="block mb-1 font-medium"
                                >
                                    Complemento
                                </label>
                                <input
                                    type="text"
                                    id="complemento"
                                    class="w-full border border-gray-300 p-2 rounded-md"
                                    placeholder="Apartamento, bloco, etc."
                                />
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label
                                        for="bairro"
                                        class="block mb-1 font-medium"
                                    >
                                        Bairro
                                        <span class="required-star">*</span>
                                    </label>
                                    <input
                                        type="text"
                                        id="bairro"
                                        class="w-full border border-gray-300 p-2 rounded-md"
                                        placeholder="Bairro"
                                    />
                                </div>
                                <div>
                                    <label
                                        for="cidade"
                                        class="block mb-1 font-medium"
                                    >
                                        Cidade
                                        <span class="required-star">*</span>
                                    </label>
                                    <input
                                        type="text"
                                        id="cidade"
                                        class="w-full border border-gray-300 p-2 rounded-md"
                                        placeholder="Cidade"
                                    />
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label
                                        for="uf"
                                        class="block mb-1 font-medium"
                                    >
                                        Estado
                                        <span class="required-star">*</span>
                                    </label>
                                    <select
                                        id="uf"
                                        class="w-full border border-gray-300 p-2 rounded-md"
                                    >
                                        <option value="">Selecione...</option>
                                        <option value="AC">AC</option>
                                        <option value="AL">AL</option>
                                        <option value="AP">AP</option>
                                        <option value="AM">AM</option>
                                        <option value="BA">BA</option>
                                        <option value="CE">CE</option>
                                        <option value="DF">DF</option>
                                        <option value="ES">ES</option>
                                        <option value="GO">GO</option>
                                        <option value="MA">MA</option>
                                        <option value="MT">MT</option>
                                        <option value="MS">MS</option>
                                        <option value="MG">MG</option>
                                        <option value="PA">PA</option>
                                        <option value="PB">PB</option>
                                        <option value="PR">PR</option>
                                        <option value="PE">PE</option>
                                        <option value="PI">PI</option>
                                        <option value="RJ">RJ</option>
                                        <option value="RN">RN</option>
                                        <option value="RS">RS</option>
                                        <option value="RO">RO</option>
                                        <option value="RR">RR</option>
                                        <option value="SC">SC</option>
                                        <option value="SP">SP</option>
                                        <option value="SE">SE</option>
                                        <option value="TO">TO</option>
                                    </select>
                                </div>
                                <div>
                                    <label
                                        for="telefone"
                                        class="block mb-1 font-medium"
                                    >
                                        Telefone
                                        <span class="required-star">*</span>
                                    </label>
                                    <input
                                        type="tel"
                                        id="telefone"
                                        class="w-full border border-gray-300 p-2 rounded-md"
                                        inputmode="numeric"
                                        placeholder="(00) 00000-0000"
                                        maxlength="15"
                                        oninput="formatarTelefone(this)"
                                    />
                                </div>
                            </div>
                            <div class="pt-4">
                                <button
                                    type="submit"
                                    id="submit-button"
                                    class="btn-primary w-full py-3 rounded-md flex items-center justify-center"
                                    disabled
                                >
                                    <i class="fas fa-arrow-right mr-2"></i>
                                    <span>Continuar</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
        <footer class="footer-bg text-black py-4 text-xs">
            <div class="container mx-auto px-4">
                <div class="flex flex-col items-center mb-2">
                    <img
                        src="../images/logo-marinha.png"
                        onerror="this.src='../images/logo-marinha.png'"
                        alt="Marinha do Brasil"
                        height="30"
                        width="60"
                        style="object-fit: contain"
                    />
                </div>
                <div class="flex justify-between items-center">
                    <div>&copy; Código de Ética e Conduta | Política de Integridade</div>
                    <div class="flex items-center">
                        <i class="fas fa-globe mr-1"></i> Fundação Marinha do Brasil
                    </div>
                </div>
            </div>
        </footer>
    </body>
</html>
